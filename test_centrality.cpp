#include<iostream>
#include<algorithm>
#include <queue>
#include <set>
#include <vector>
#include <time.h>
#include <cmath>
#include "log.h"

using namespace std;
int main(){
    /*   
    int zero = 0;
    double name;
    if(zero == 0){
        name = 0;
    }else{
        name = zero*1.0 /10000;
    }
    
    printf("%f is in loop\n",name);
    */
    string dataset = "graph_spa_500_10_tp";
    InfGraph g = buildGraph(dataset);
    // double epsilon_prime = arg.epsilon * sqrt(2);
    // int64 ci = (2+2/3 * epsilon_prime)* ( log(g.numVert) + Math::logcnk(g.numVert, arg.k) + log(Math::log2(g.numVert))) * pow(2.0, x) / (epsilon_prime* epsilon_prime);
    printf("there are %d nodes\n",g.numVert);
    // vector<int> see;
    // see = vector<bool> (10);
    // for (int i = 0; i < see.size(); i++)
    // {         
    //     see[i] = i;         
    // } 
    // printf("does is exist? %d",see[1]);
    int MC = 1000;
    int BUDGET = 500;
    double EPSILON = 0.01;
    int TEST = 10;
    string method = "pagerank9";
    string model = "ic";
    inPut in ={.BUDGET =BUDGET,.MCROUNDS= MC, .EPSILON = EPSILON,.dataset = dataset, .SAMPLE_ROUND= 100, .ALPHA = 0.1, .TEST = TEST, .MODEL = model};
    vector <double> influence(BUDGET);
    // int *counter = (int*)malloc(sizeof(int)*g.numVert);
    queue<int> s;
    s.push(2);
    vector<int> seed;
    vector<int> seed_centrality_increse ={1, 2, 7, 11, 192, 211, 187, 169, 81, 94, 121, 171, 114, 63, 124, 53, 180, 170, 210, 101, 70, 201, 218, 208, 156, 144, 109, 158, 189, 215, 160, 159, 197, 204, 186, 195, 162, 176, 183, 152, 182, 220, 224, 227, 237, 254, 253, 246, 248, 258, 260, 262, 404, 346, 362, 320, 427, 343, 284, 297, 322, 329, 354, 403, 366, 315, 325, 447, 344, 392, 332, 426, 443, 459, 368, 331, 370, 432, 451, 439, 435, 450, 417, 458, 441, 448, 434, 456, 463, 475, 467, 476, 468, 473, 478, 472, 477, 480, 488, 491, 490, 496, 10, 38, 48, 91, 44, 100, 60, 191, 198, 184, 168, 140, 188, 205, 125, 145, 39, 71, 93, 116, 110, 202, 165, 217, 193, 209, 212, 90, 102, 111, 143, 127, 120, 153, 219, 161, 231, 235, 236, 229, 234, 233, 245, 250, 241, 249, 251, 252, 243, 257, 259, 290, 431, 373, 279, 446, 334, 316, 335, 440, 294, 415, 398, 399, 396, 438, 377, 318, 442, 452, 375, 421, 430, 376, 436, 401, 420, 462, 469, 474, 483, 484, 486, 494, 493, 495, 499, 6, 8, 45, 49, 175, 214, 34, 78, 25, 51, 85, 40, 54, 138, 122, 74, 190, 200, 86, 52, 83, 177, 216, 84, 92, 164, 115, 155, 174, 76, 128, 166, 199, 103, 108, 179, 106, 141, 97, 133, 181, 167, 230, 232, 247, 255, 339, 268, 310, 326, 455, 457, 419, 293, 324, 341, 389, 408, 380, 305, 348, 355, 388, 407, 319, 390, 363, 400, 418, 359, 406, 312, 445, 347, 412, 357, 352, 382, 360, 429, 453, 437, 470, 471, 487, 489, 497, 498, 0, 3, 4, 15, 28, 64, 132, 261, 61, 89, 17, 80, 43, 21, 134, 107, 137, 42, 56, 77, 87, 113, 79, 32, 148, 172, 173, 46, 151, 207, 72, 112, 149, 88, 157, 154, 203, 136, 142, 206, 196, 225, 226, 242, 244, 308, 425, 371, 449, 340, 302, 361, 423, 298, 454, 303, 385, 304, 381, 422, 364, 379, 372, 323, 424, 358, 333, 394, 351, 374, 444, 393, 383, 460, 369, 428, 405, 409, 410, 416, 465, 466, 482, 9, 23, 31, 57, 82, 41, 65, 62, 221, 213, 126, 69, 123, 105, 118, 104, 119, 163, 222, 178, 131, 239, 277, 300, 311, 365, 378, 267, 314, 287, 349, 402, 286, 327, 338, 328, 386, 387, 397, 350, 321, 336, 345, 342, 356, 395, 433, 411, 485, 14, 27, 59, 37, 139, 479, 117, 150, 67, 68, 130, 129, 135, 185, 147, 146, 461, 194, 228, 295, 306, 272, 281, 282, 296, 274, 299, 384, 413, 313, 309, 414, 5, 18, 19, 36, 98, 58, 96, 256, 273, 271, 283, 278, 288, 337, 353, 391, 16, 95, 50, 73, 99, 264, 330, 317, 367, 238, 13, 22, 30, 55, 464, 492, 269, 291, 276, 29, 240, 265, 301, 289, 292, 33, 47, 307, 20, 66, 223, 270, 275, 285, 24, 35, 481, 280, 26, 75, 12, 266, 263};
    vector<int> local_density_increase= {474, 84, 220, 237, 258, 260, 463, 466, 477, 495, 43, 442, 499, 232, 240, 7, 42, 83, 210, 128, 88, 109, 189, 215, 160, 141, 97, 133, 143, 204, 186, 142, 226, 233, 418, 351, 357, 360, 401, 450, 441, 469, 478, 472, 490, 95, 89, 86, 52, 230, 69, 165, 217, 90, 236, 309, 377, 462, 30, 40, 76, 108, 146, 380, 242, 465, 397, 433, 256, 1, 2, 211, 41, 59, 184, 77, 138, 145, 169, 63, 124, 46, 53, 180, 218, 174, 209, 144, 158, 127, 136, 195, 183, 182, 229, 234, 253, 246, 248, 257, 259, 262, 447, 358, 452, 421, 430, 444, 451, 439, 411, 448, 467, 476, 468, 473, 492, 330, 271, 283, 384, 31, 123, 131, 173, 244, 323, 92, 106, 293, 341, 352, 470, 471, 336, 342, 356, 395, 12, 125, 32, 193, 120, 298, 396, 374, 376, 369, 409, 410, 57, 345, 485, 238, 115, 155, 285, 305, 348, 319, 390, 497, 498, 112, 307, 306, 299, 413, 414, 391, 47, 11, 22, 49, 214, 100, 114, 126, 101, 208, 166, 199, 111, 247, 255, 295, 302, 329, 354, 317, 313, 315, 312, 445, 443, 318, 333, 394, 459, 432, 382, 435, 429, 417, 420, 456, 491, 16, 378, 321, 276, 99, 157, 203, 304, 381, 424, 383, 460, 405, 416, 5, 35, 34, 51, 122, 164, 419, 324, 406, 453, 487, 65, 3, 17, 44, 107, 73, 245, 250, 425, 301, 415, 494, 18, 58, 353, 82, 118, 222, 78, 179, 310, 359, 347, 412, 273, 15, 28, 64, 151, 207, 364, 428, 482, 23, 163, 33, 228, 272, 36, 367, 464, 10, 14, 80, 26, 27, 55, 190, 110, 202, 219, 162, 176, 268, 402, 373, 343, 338, 284, 278, 297, 422, 366, 398, 399, 332, 426, 458, 480, 493, 75, 275, 314, 350, 134, 56, 225, 96, 337, 481, 139, 150, 167, 274, 349, 66, 19, 269, 132, 20, 137, 79, 72, 129, 461, 161, 206, 231, 249, 252, 243, 340, 294, 438, 375, 436, 13, 387, 50, 45, 177, 216, 67, 135, 194, 291, 385, 372, 119, 239, 327, 292, 223, 98, 263, 266, 8, 261, 21, 60, 191, 221, 70, 201, 102, 251, 270, 286, 320, 427, 389, 334, 370, 288, 185, 213, 105, 178, 386, 423, 400, 489, 9, 287, 289, 0, 39, 71, 116, 154, 196, 241, 296, 279, 446, 361, 393, 104, 280, 175, 85, 37, 117, 200, 363, 61, 149, 303, 29, 147, 6, 25, 198, 87, 188, 148, 172, 130, 156, 103, 159, 197, 408, 388, 368, 484, 282, 62, 454, 479, 326, 457, 355, 311, 4, 48, 68, 281, 486, 264, 407, 24, 113, 308, 449, 300, 140, 205, 94, 121, 171, 74, 181, 265, 371, 455, 346, 316, 335, 440, 331, 475, 483, 496, 267, 379, 328, 339, 365, 38, 91, 81, 212, 254, 403, 325, 168, 93, 235, 54, 170, 277, 344, 392, 434, 187, 224, 227, 362, 322, 437, 488, 431, 290, 153, 152, 192, 404};
    vector<int> pagerank9_increase = {152, 161, 196, 331, 434, 437, 456, 206, 370, 493, 491, 114, 233, 162, 11, 315, 447, 171, 260, 392, 110, 477, 120, 218, 208, 404, 401, 322, 182, 332, 224, 499, 446, 451, 187, 70, 143, 417, 453, 90, 215, 334, 248, 347, 463, 354, 184, 193, 176, 320, 403, 53, 432, 366, 54, 373, 1, 348, 194, 284, 478, 329, 60, 372, 159, 435, 158, 368, 190, 325, 459, 211, 219, 72, 436, 254, 102, 344, 352, 153, 170, 177, 369, 232, 235, 490, 486, 290, 416, 333, 8, 468, 346, 475, 236, 191, 268, 118, 169, 423, 426, 388, 227, 405, 81, 134, 362, 230, 472, 71, 109, 480, 183, 144, 308, 462, 498, 160, 358, 154, 444, 56, 440, 155, 402, 186, 279, 92, 452, 205, 84, 39, 168, 488, 133, 420, 438, 390, 136, 484, 467, 253, 63, 427, 396, 412, 483, 497, 180, 237, 495, 374, 204, 471, 199, 429, 281, 97, 173, 130, 2, 379, 192, 485, 450, 430, 250, 445, 209, 164, 409, 197, 318, 470, 394, 124, 142, 241, 441, 375, 355, 94, 121, 226, 212, 28, 359, 7, 259, 10, 249, 128, 245, 3, 91, 406, 393, 32, 448, 400, 479, 247, 51, 385, 443, 496, 428, 175, 252, 103, 262, 310, 422, 442, 474, 326, 112, 125, 407, 202, 178, 222, 337, 414, 363, 131, 138, 88, 267, 376, 61, 80, 439, 220, 41, 231, 473, 86, 116, 198, 251, 48, 189, 122, 141, 342, 377, 338, 460, 174, 274, 277, 115, 343, 101, 156, 214, 108, 44, 181, 166, 327, 74, 188, 458, 31, 365, 487, 433, 469, 335, 38, 239, 424, 461, 93, 67, 200, 139, 382, 489, 482, 146, 87, 83, 201, 321, 213, 68, 328, 295, 217, 415, 256, 410, 107, 380, 300, 255, 123, 50, 179, 381, 360, 17, 105, 147, 391, 312, 418, 5, 340, 389, 419, 137, 494, 387, 316, 100, 6, 398, 457, 127, 43, 258, 52, 384, 299, 283, 246, 96, 203, 4, 195, 65, 399, 76, 234, 106, 46, 9, 113, 119, 111, 145, 15, 411, 207, 172, 210, 151, 286, 264, 140, 306, 313, 34, 167, 319, 244, 303, 476, 243, 314, 59, 273, 397, 257, 0, 305, 425, 261, 148, 431, 339, 302, 371, 25, 361, 149, 49, 33, 221, 304, 455, 353, 294, 135, 413, 345, 364, 225, 336, 69, 85, 163, 150, 289, 449, 77, 421, 66, 296, 356, 464, 64, 395, 157, 383, 165, 466, 288, 287, 22, 317, 291, 378, 272, 298, 57, 95, 216, 350, 454, 27, 37, 330, 386, 349, 269, 82, 293, 301, 132, 341, 78, 357, 408, 99, 36, 351, 311, 238, 309, 242, 265, 481, 21, 229, 367, 23, 30, 45, 26, 79, 324, 126, 14, 40, 240, 465, 89, 19, 307, 13, 297, 492, 117, 62, 280, 47, 323, 278, 270, 98, 29, 58, 16, 20, 228, 73, 55, 42, 276, 24, 185, 104, 12, 282, 129, 75, 266, 285, 223, 292, 263, 271, 35, 275, 18};

    vector<double> tim ;
    seed = pagerank9_increase;
    for(int i=0;i<seed.size();i++){
        tim.push_back(0);
    }


    vector<double> maxinf;
    queue<int> centrality_py_select;


    // srandx(time(NULL));
    // srand (time(NULL));
    cout<<"random generation"<<endl;
    for(int i=0;i<100;i++){
        int name = randx();
        double fix = randam();
        // printf("name is: %d ",name);
        // printf( "fix is %f\n",fix);
    }
    
    double sprd;
    
    for(int i = 1;i<TEST;i++){
        for(int i=0;i<seed.size();i++){
            int node = seed[i];
            // cout<<seed[i]<<" ";
            // myopic_py_select.push(node);
            // pair<double,int> round =icExp_lazy(g, myopic_py_select, MC,EPSILON);
            // maxinf.push_back(round.first);
            centrality_py_select.push(node);
            float* counter = icExp_lazy(g, centrality_py_select, MC);
            // // printf("in budget %d",i);
            // for(int j =0;j<g.numVert;j++){
            //     // const auto& count = count/mc;
            //     if(counter[j] ==0){
            //         cout<<counter[j]<<" " << j << " ";

            //     }

            // }
            
            double min_expect = *min_element(counter+0, counter+g.numVert);
            min_expect = min_expect*1.0/MC;

            maxinf.push_back(min_expect);
            // printf("selecting node %d with %f influence\n", i, min_expect);
            // float* counter = icExp_hyperG(g, myopic_py_select, MC);
            // double min = *min_element(counter+0,counter+g.numVert);
            // maxinf.push_back(min);
        }
        for(int j = 0;j<BUDGET;j++){
            sprd = maxinf[j];
            // double clock = res.time[j];
            
            influence[j] += sprd;
            // time[j] += clock;
        }  
      printf("we've finished %d round test\n",i);


    }      
    for(int j = 0;j<BUDGET;j++){
        influence[j] = influence[j]*1.0/TEST;
        // time[j] = time[j]*1.0/TEST;
    }
    values res ={seed,influence,tim};
    logRec(g, res, in, method);
    /**/

}